<script>
  const filterItems = document.querySelectorAll("*[data-filter]");
  const cards = document.querySelectorAll(".card");
  let itemsCounter = window.innerWidth <= 800 ? 6 : 12;
  const showMoreBtn = document.querySelector(".show-more");
  const hideCatalogCategory = () => {
    let categorySelects = document.querySelectorAll(".catalog__category");
    if (categorySelects.length > 0) {
      categorySelects.forEach((element) => {
        element.style.display = "none";
      });
    }
  };
  const checkCardsLength = (items) => {
    items.length >= itemsCounter
      ? (showMoreBtn.style.display = "flex")
      : (showMoreBtn.style.display = "none");
  };
  const hideCards = (items) => {
    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      item.style.display = "none";
    }

    for (let i = 0; i < itemsCounter; i++) {
      const item = items[i];
      item.style.display = "flex";
    }
  };
  const showCards = (items) => {
    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      item.style.display = "flex";
    }
  };
  if (cards.length > 0) {
    for (let i = 0; i < cards.length; i++) {
      const card = cards[i];
      card.setAttribute("id", `card-${i + 1}`);
      hideCards(cards);
    }
    checkCardsLength(cards);
  }
  if (filterItems.length > 0) {
    filterItems.forEach((item) => {
      item.addEventListener("click", (e) => {
        e.preventDefault();
        let _this = e.currentTarget;
        let currentFilter = _this.dataset.filter;
        let sortableCard = document.querySelector(
          `.card[data-sortable="${currentFilter}"]`
        );
        if (currentFilter !== "reset") {
          cards.forEach((element) => {
            element.style.display = "none";
          });
          sortableCard ? (sortableCard.style.display = "flex") : "";
          if (sortableCard && sortableCard.length >= itemsCounter) {
            showMoreBtn.style.display = "flex";
          } else {
            showMoreBtn.style.display = "none";
          }
        } else {
          hideCards(cards);
          checkCardsLength(cards);
          let currentOptions =
            _this.parentNode.querySelectorAll(".custom-option");
          let currentSelectTriggerText = _this.parentNode.querySelectorAll(
            ".cards__filter-select__trigger-text"
          );
          let currentDefOptions =
            _this.parentNode.querySelectorAll(".custom-def-option");

          currentOptions.forEach((element) => {
            element.classList.remove("selected");
          });
          currentDefOptions.forEach((element) => {
            element.classList.add("selected");
          });
          currentSelectTriggerText.forEach((element) => {
            element.textContent = "Выбрать";
          });
          hideCatalogCategory();
        }
      });
    });
  }
  const showMore = (e, getParent, classContain, defText, altText) => {
    let _this = e.currentTarget;
    let parent = document.querySelector(getParent);

    if (!parent.classList.contains(classContain)) {
      _this.textContent = altText;
      showCards(cards);
      parent.classList.add(classContain);
    } else {
      hideCards(cards);
      _this.textContent = defText;
      parent.classList.remove(classContain);
    }
  };
  if (showMoreBtn) {
    showMoreBtn.addEventListener("click", (e) => {
      showMore(e, "#cards", "__show-cards", "Показать еще", "Скрыть");

      e.preventDefault();
    });
  }
</script>
